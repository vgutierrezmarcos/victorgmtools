# AGENTS.md

This file guides agentic coding tools (Claude, Cursor, etc.) working on the `victorgmtools` R package.

## 1. Build, Lint, and Test Commands

This project uses `devtools` for package management. There is no formal `testthat` suite currently; checks rely on `devtools::check()` and ad-hoc scripts.

### Core Commands (Run via Bash)
*   **Load Package (Interactive/Dev):**
    ```bash
    R -e 'devtools::load_all()'
    ```
*   **Generate Documentation (roxygen2):**
    ```bash
    R -e 'devtools::document()'
    ```
    *Always run this after modifying function headers or exports.*
*   **Full Package Check (Lint/Build/Test):**
    ```bash
    R -e 'devtools::check()'
    ```
*   **Install Package Locally:**
    ```bash
    R -e 'devtools::install()'
    ```

### Testing Strategy
Since there is no `tests/testthat` directory:
1.  **Ad-hoc Testing:** Create/modify scripts in `pruebas/` (e.g., `pruebas/pruebas_graficos.R`) to verify changes.
2.  **Manual Verification:** Use `devtools::load_all()` and test functions in an interactive R session if possible, or write a temporary R script.
3.  **Single Test Equivalent:** To test a specific function, create a script in `pruebas/temp_test.R` that loads the package and runs the function, then execute:
    ```bash
    Rscript pruebas/temp_test.R
    ```

## 2. Code Style & Conventions

Adhere strictly to the existing style found in `R/`.

### Formatting & Syntax
*   **Indentation:** 2 spaces.
*   **Pipe Operator:** Use the native pipe `|>` (not `%>%`).
*   **Assignment:** Use `<-`, not `=`.
*   **Line Length:** Aim for ~80 characters, but do not aggressively wrap.

### Naming Conventions
*   **Functions:** `snake_case` (e.g., `get_tasa_variacion`, `crear_agrupacion`).
    *   Prefixes: `get_`, `crear_`, `aplicar_`, `tabla_`, `tema_`, `mapa_`, `to_`, `colores_`.
*   **Arguments:** **MUST** use a dot prefix (e.g., `.datos_df`, `.col_fecha`, `.frecuencia`).
*   **Variables:** `snake_case`.

### Data Manipulation (Tidyverse)
*   **Namespaces:** **ALWAYS** use fully qualified function calls (e.g., `dplyr::filter`, `tidyr::pivot_wider`). Do not rely on implicit imports in the source code.
*   **Non-Standard Evaluation (NSE):**
    *   Use `rlang::sym()` combined with `!!` (bang-bang) for dynamic column references.
    *   Example: `dplyr::filter(!!rlang::sym(.col_flujo) == .export)`
    *   For grouping/selecting, use `dplyr::across(tidyselect::all_of(.col_nombres))`.

### Documentation (Roxygen2)
*   Use `#'` comments above functions.
*   Include `@param`, `@return`, and `@export` tags.
*   Set `markdown = TRUE` (default in this repo).
*   **NEVER** edit `NAMESPACE` manually; it is generated by `devtools::document()`.

### File Structure
*   Code resides in `R/`.
*   Group functions by category (e.g., `R/funciones_calculos.R` for math, `R/funciones_graficos.R` for plots).
*   Use comment headers to separate sections within files:
    ```r
    # Section Name ----
    ```

### Error Handling
*   Use `stopifnot()` for basic argument validation at the start of functions.
*   Use `warning()` for non-critical issues (e.g., implicit type conversion).
*   Use `stop()` for critical failures.

## 3. Dependencies
*   Check `DESCRIPTION` for available packages.
*   Common: `dplyr`, `tidyr`, `rlang`, `ggplot2`, `fredr`, `gt`, `duckdb`.
*   **Note:** `wtor` is a GitHub remote (`fabiansalazares/wtor`).

## 4. Specific Patterns
*   **DuckDB:** Functions with suffix `_duckplyr` use `duckdb`/`duckplyr` for performance.
*   **Plotting:** Functions often accept an `.estatico` boolean to toggle between `ggplot2` (static) and `ggiraph` (interactive).
